<div id='main_body'>
<h4>任务申请内容 </h4>

<p>
  <b>任务名称:</b>
  <%= @task.task_template.task_definition.name %>
</p>
<p>
  <b>申请名称:</b>
  <%= @task_request.name %>
</p> 
<p>
  <b>申请人:</b>
  <%= @task_request.requested_by.name %>
</p> 
<p>
  <b>申请状态:</b>
  <%= @task_request.request_status.try(:name) if @task_request.request_status_id.present? %>
</p> 
<p>
  <b>申请日期:</b>
  <%= @task_request.request_date.strftime("%Y/%m/%d") %>
</p> 
<p>
  <b>预计完成日期:</b>
  <%= @task_request.expected_finish_date.strftime("%Y/%m/%d") %>
</p> 
<p>
  <b>加急:</b>
  <%= @task_request.expedite ? '是' : '否' %>
</p> 
<p>
  <b>完成:</b>
  <%= @task_request.completed ? '是' : '否' %>
</p> 

<p>
  <b>取消:</b>
  <%= @task_request.cancelled ? '是' : '否' %>
</p> 
<p>
  <b>输入/更新:</b>
  <%= @task_request.last_updated_by.name %>
</p>
<p>
  <b>LOG：</b>
  <% Commonx::Log.where('resource_id = ? AND resource_name = ?', @task_request.id, params[:controller].sub('/', '_')).order("created_at DESC").each do |t| %>
    <li><%= t.created_at.strftime("%Y/%m/%d") %>, &nbsp;<%= t.last_updated_by.name %>, &nbsp; <%= t.log %></li>
  <% end %>
</p>

	<table class="table table-striped">
	  <tr>
	    <th>
	    	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	    	<%= link_to t('New Log'), SUBURI + commonx.new_task_request_log_path(:resource_id => @task_request.id, :resource_name => params[:controller], :subaction => 'task_request', :format => :js), :remote => true, 
	                  :id => 'new_log_link', :class => BUTTONS_CLS['action'] if has_action_right?('create_task_request', 'commonx_logs') %>
	    </th>
	  </tr>
	</table>

	<%= link_to t('Back'), SUBURI + "/authentify/view_handler?index=0", :id => 'close', :class => BUTTONS_CLS['action']%>
</div>